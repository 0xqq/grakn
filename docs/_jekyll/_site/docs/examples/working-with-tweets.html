<!DOCTYPE html>

<head>
    
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="An example which demonstrates key Grakn concepts in a practical setting">
<meta name="keywords" content="analyticssocial-mediastreamingtwitterexamples,  analytics, social-media, streaming, twitter, GRAKN.AI, Grakn Labs, grakn, graql, grakn.ai, Mindmaps Research, Mindmaps Research Ltd, MindmapsDB, mindmaps, mindmaps graph, mindmaps.io, knowledge graph, distributed knowledge graph, development platform, developer tool, data platform, programming langauge, query langauge, database, semantic database, distributed semantic database, distributed database, graph database, semantic search, data exploration, recommendation system, knowledge management, knowledge engineering, real-time analytics, advanced analytics, reasoning engine, inference engine, expert systems, semantic applications, research engines, data management, business intelligence, big data, semantic web, semantic data, knowledge representation, automated reasoning, semantic network, knowledge ontology, semantic graph, ontology engineering, graph based knowledge representation, artificial intelligence,">
<title>Working With Tweets | GRAKN.AI</title>
<meta property="og:description" content="An example which demonstrates key Grakn concepts in a practical setting">
<meta property="og:title" content="Working With Tweets | GRAKN.AI" >
<meta property="og:image" content="/images/og-image.png" >
<link rel="stylesheet" href="/css/syntax.css">


<link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">
<!--<link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">-->
<link rel="stylesheet" href="/css/modern-business.css">
<link rel="stylesheet" href="/css/lavish-bootstrap.css">
<link rel="stylesheet" href="/css/hamburger.min.css">
<link rel="stylesheet" href="/css/customstyles.css">
<link rel="stylesheet" href="/css/theme-white.css">

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
<script src="/js/jquery.navgoco.min.js"></script>


<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/2.0.0/anchor.min.js"></script>
<script src="/js/toc.js"></script>
<script src="/js/prism.js"></script>
<script src="/js/prism-graql.js"></script>
<script src="/js/customscripts.js"></script>

<link rel="shortcut icon" href="/favicon.ico">

<!-- Facebook Pixel Code -->
<script>
!function(f,b,e,v,n,t,s){if(f.fbq)return;n=f.fbq=function(){n.callMethod?
n.callMethod.apply(n,arguments):n.queue.push(arguments)};if(!f._fbq)f._fbq=n;
n.push=n;n.loaded=!0;n.version='2.0';n.queue=[];t=b.createElement(e);t.async=!0;
t.src=v;s=b.getElementsByTagName(e)[0];s.parentNode.insertBefore(t,s)}(window,
document,'script','https://connect.facebook.net/en_US/fbevents.js');
fbq('init', '2009892122581066'); // Insert your pixel ID here.
fbq('track', 'PageView');
</script>
<noscript><img height="1" width="1" style="display:none"
src="https://www.facebook.com/tr?id=2009892122581066&ev=PageView&noscript=1" alt="facebook pixel"
/></noscript>
<!-- DO NOT MODIFY -->
<!-- End Facebook Pixel Code -->

<!-- Start of HubSpot Embed Code -->
<script type="text/javascript" id="hs-script-loader" async defer src="//js.hs-scripts.com/4332244.js"></script>
<!-- End of HubSpot Embed Code -->

<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
<script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
<![endif]-->

<link rel="alternate" type="application/rss+xml" title="" href="http://grakn.ai/pages/feed.xml">

    <script>
        $(document).ready(function() {
            // Initialize navgoco with default options
            $("#mysidebar").navgoco({
                caretHtml: '',
                accordion: true,
                openClass: 'active', // open
                save: false, // leave false or nav highlighting doesn't work right
                cookie: {
                    name: 'navgoco',
                    expires: false,
                    path: '/'
                },
                slide: {
                    duration: 400,
                    easing: 'swing'
                }
            });

            $("#collapseAll").click(function(e) {
                e.preventDefault();
                $("#mysidebar").navgoco('toggle', false);
            });

            $("#expandAll").click(function(e) {
                e.preventDefault();
                $("#mysidebar").navgoco('toggle', true);
            });

        });

    </script>
    <script>
        $(function () {
            $('[data-toggle="tooltip"]').tooltip()
        })
    </script>
    

</head>
<body>

<svg xmlns="http://www.w3.org/2000/svg" width="0" height="0" style="display: none;">
    <symbol id="logo" viewBox="0 0 40 40" aria-labelledby="GRAKN.AI">
       <value>GRAKN.AI</value>
       <desc>A Distributed Knowledge Graph</desc>
       <polygon vector-effect="non-scaling-stroke" fill="transparent" stroke-linejoin="round" points="20,2 38,20 20,38 2,20"/>
       <polyline vector-effect="non-scaling-stroke" fill="transparent" stroke-linejoin="round" points="7.27,32.73 7.27,7.27 20,20 32.73,7.27 32.73,32.73"/>
    </symbol>
    <symbol id="github" viewBox="0 0 16 16" aria-labelledby="GitHub">
        <value>GitHub</value>
        <desc>GitHub</desc>
        <path vector-effect="non-scaling-stroke" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0 0 16 8c0-4.42-3.58-8-8-8z"></path>
    </symbol>
    <symbol id="gitter" viewBox="0 0 28 40" aria-labelledby="Gitter">
        <value>Gitter</value>
        <desc>Gitter</desc>
        <rect vector-effect="non-scaling-stroke" x="15.6" y="6.4" width="3.2" height="33.6"/>
        <rect vector-effect="non-scaling-stroke" x="22" y="6.4" width="3.2" height="17.6"/>
        <rect vector-effect="non-scaling-stroke" x="9.2" y="6.4" width="3.2" height="33.6"/>
        <rect vector-effect="non-scaling-stroke" x="2.8" width="3.2" height="24"/>
    </symbol>
    <symbol id="slack" viewBox="0 0 256 256" aria-labelledby="Slack">
        <path d="M165.963541,15.8384262 C162.07318,3.86308197 149.212328,-2.69009836 137.239082,1.20236066 C125.263738,5.09272131 118.710557,17.9535738 122.603016,29.9268197 L181.550164,211.292328 C185.597902,222.478689 197.682361,228.765377 209.282098,225.426885 C221.381246,221.943607 228.756984,209.093246 224.896,197.21023 C224.749115,196.756984 165.963541,15.8384262 165.963541,15.8384262"></path>
        <path d="M74.6260984,45.515541 C70.7336393,33.5422951 57.8727869,26.9891148 45.899541,30.8794754 C33.9241967,34.7698361 27.3710164,47.6306885 31.2634754,59.6060328 L90.210623,240.971541 C94.2583607,252.157902 106.34282,258.44459 117.942557,255.104 C130.041705,251.62282 137.417443,238.772459 133.556459,226.887344 C133.409574,226.436197 74.6260984,45.515541 74.6260984,45.515541"></path>
        <path d="M240.161574,166.045377 C252.136918,162.155016 258.688,149.294164 254.797639,137.31882 C250.907279,125.345574 238.046426,118.792393 226.07318,122.682754 L44.7076721,181.632 C33.5213115,185.677639 27.234623,197.762098 30.5731148,209.361836 C34.0563934,221.460984 46.9067541,228.836721 58.7897705,224.975738 C59.2430164,224.828852 240.161574,166.045377 240.161574,166.045377"></path>
        <path d="M82.507541,217.270557 C94.312918,213.434754 109.528131,208.491016 125.855475,203.186361 C122.019672,191.380984 117.075934,176.163672 111.76918,159.83423 L68.4191475,173.924721 L82.507541,217.270557"></path>
        <path d="M173.847082,187.591344 C190.235279,182.267803 205.467279,177.31777 217.195016,173.507148 C213.359213,161.70177 208.413377,146.480262 203.106623,130.146623 L159.75659,144.237115 L173.847082,187.591344"></path>
        <path d="M210.484459,74.7058361 C222.457705,70.8154754 229.010885,57.954623 225.120525,45.9792787 C221.230164,34.0060328 208.369311,27.4528525 196.393967,31.3432131 L15.028459,90.292459 C3.84209836,94.3380984 -2.44459016,106.422557 0.896,118.022295 C4.37718033,130.121443 17.227541,137.49718 29.1126557,133.636197 C29.5638033,133.489311 210.484459,74.7058361 210.484459,74.7058361"></path>
        <path d="M52.8220328,125.933115 C64.6274098,122.097311 79.8468197,117.151475 96.1762623,111.84682 C90.8527213,95.4565246 85.9026885,80.2245246 82.0920656,68.4946885 L38.731541,82.5872787 L52.8220328,125.933115"></path>
        <path d="M144.159475,96.256 C160.551869,90.9303607 175.785967,85.9803279 187.515803,82.1676066 C182.190164,65.7752131 177.240131,50.5390164 173.42741,38.807082 L130.068984,52.8996721 L144.159475,96.256"></path>
    </symbol>
</svg>

<div class="navigation-bar">
    <div class="container">
      <a class="navigation-bar__logo" href="https://grakn.ai/"><img src="https://grakn.ai/assets/svg/logo.svg" alt="Grakn AI"></a>
        <div class="navigation-bar__links navigation-bar__links--desktop">
            <a class="navigation-bar__link navigation-bar__link__inline navigation-bar__link__button" href="https://grakn.ai/download" id="download_nav_bar">Download</a>
            <div class="navigation-bar__link navigation-bar__link__dropdown">
                <!-- react-text: 233 -->Products
                <!-- /react-text --><i class="fa fa-caret-down" aria-hidden="true"></i>
                <div class="navigation-bar__link__dropdown__content"><a class="navigation-bar__link navigation-bar__link__dropdown__content__item animated__link" href="https://grakn.ai/grakn-core">Grakn Core</a><a class="navigation-bar__link navigation-bar__link__dropdown__content__item animated__link" href="https://grakn.ai/grakn-kbms">Grakn KBMS & Workbase</a></div>
            </div>
            <div class="navigation-bar__link navigation-bar__link__dropdown">
                <!-- react-text: 239 -->Solutions
                <!-- /react-text --><i class="fa fa-caret-down" aria-hidden="true"></i>
                <div class="navigation-bar__link__dropdown__content"><a class="navigation-bar__link navigation-bar__link__dropdown__content__item animated__link" href="https://grakn.ai/deployment">Deployment</a><a class="navigation-bar__link navigation-bar__link__dropdown__content__item animated__link" href="https://grakn.ai/services">Services</a><a class="navigation-bar__link navigation-bar__link__dropdown__content__item animated__link"
                        href="https://grakn.ai/support">Support</a></div>
            </div>
            <div class="navigation-bar__link navigation-bar__link__dropdown">
                <!-- react-text: 255 -->Developer
                <!-- /react-text --><i class="fa fa-caret-down" aria-hidden="true"></i>
                <div class="navigation-bar__link__dropdown__content"><a href="https://dev.grakn.ai/academy/" class="navigation-bar__link navigation-bar__link__dropdown__content__item animated__link" target="_self">Academy</a><a href="https://dev.grakn.ai" class="navigation-bar__link navigation-bar__link__dropdown__content__item animated__link" target="_self">Documentation</a><a href="https://discuss.grakn.ai/" class="navigation-bar__link navigation-bar__link__dropdown__content__item animated__link" target="_self">Discussion</a></div>
            </div><a class="navigation-bar__link navigation-bar__link__inline animated__link" href="https://grakn.ai/community">Community</a><a href="https://blog.grakn.ai/" class="navigation-bar__link navigation-bar__link__inline animated__link"
                target="_blank">Blog</a><a href="https://github.com/graknlabs/grakn" class="navigation-bar__link navigation-bar__link__inline" target="_blank"><i class="fa fa-2x fa-github navigation-bar__link__icon" aria-hidden="true"></i></a>
            </div>
            <div class="navigation-bar__links navigation-bar__links--mobile">
                <button id="hamburger-btn" class="navigation-bar__hamburger__button hamburger hamburger--collapse" aria-hidden="true"><span class="hamburger-box"><span class="hamburger-inner"></span></span></button>
                <div id="hamburger-menu" class="navigation-bar__hamburger">
                    <a class="navigation-bar__link navigation-bar__link__inline navigation-bar__link__button" href="https://grakn.ai/download" id="download_nav_bar_mobile">Download</a>
                    <div class="navigation-bar__hamburger__link navigation-bar__link navigation-bar__link__dropdown" 
                    data-links='{"Grakn Core": "https://grakn.ai/grakn-core","Grakn KBMS & Workbase": "https://grakn.ai/grakn-kbms"}'>
                        <!-- react-text: 333 -->Products
                        <!-- /react-text --><i class="fa fa-caret-right" aria-hidden="true"></i></div>
                    <div class="navigation-bar__hamburger__link navigation-bar__link navigation-bar__link__dropdown" 
                    data-links='{"Deployment": "https://grakn.ai/deployment","Services": "https://grakn.ai/services","Support": "https://grakn.ai/support"}'>
                        <!-- react-text: 336 -->Solutions
                        <!-- /react-text --><i class="fa fa-caret-right" aria-hidden="true"></i></div>
                    <div class="navigation-bar__hamburger__link navigation-bar__link navigation-bar__link__dropdown" 
                    data-links='{"Academy": "https://dev.grakn.ai/academy/","Documentation": "https://dev.grakn.ai/", "Discussion":"https://discuss.grakn.ai/"}'>
                        <!-- react-text: 342 -->Developer
                        <!-- /react-text --><i class="fa fa-caret-right" aria-hidden="true"></i></div><a class="navigation-bar__link navigation-bar__link__inline" href="https://grakn.ai/community">Community</a><a href="https://blog.grakn.ai/"
                        class="navigation-bar__link navigation-bar__link__inline" target="_blank">Blog</a><a href="https://github.com/graknlabs/grakn" class="navigation-bar__link navigation-bar__link__inline" target="_blank"><i class="fa fa-2x fa-github navigation-bar__link__icon" aria-hidden="true"></i></a></div>
                <div id="hamburger-menu-secondary"class="navigation-bar__hamburger__secondary">
                        <span id="hamburger-menu-secondary-back" class="navigation-bar__link navigation-bar__hamburger__secondary__back"><i class="fa fa-chevron-left" aria-hidden="true"></i><!-- react-text: 31 -->Back<!-- /react-text --></span>
                </div>

            </div>
    </div>
</div>
<!-- Page Content -->
<div class="container">
    <!-- Content Row -->
    <div class="row">
        <!-- Sidebar Column -->
        <div class="col-md-3 col-sidebar">
          









<ul id="mysidebar" class="nav">
    <!--start search-->
    <div id="search-demo-container">
            <input type="text" id="search-input" placeholder="Search">
            <ul id="results-container"></ul>
        </div>
        <script src="/js/jekyll-search.js" type="text/javascript"></script>
        <script type="text/javascript">
            SimpleJekyllSearch.init({
                searchInput: document.getElementById('search-input'),
                resultsContainer: document.getElementById('results-container'),
                
                dataSource: '/search.json',
                
                searchResultTemplate: '<li><a href="{url}" title="Working With Tweets">{title}</a></li>',
                noResultsText: '<li><a class="empty">No results found</a></li>',
                limit: 10,
                fuzzy: true
            });
        </script>
        <!--end search-->
    <li class="sidebarTitle">Documentation </li>
    
    
    
    <li>
        <a href="#">Get Started</a>
        <ul>
            
            
            
            <li><a href="/docs/index">Home</a></li>
            
            
            
            
            
            
            <li><a href="/docs/get-started/setup-guide">Setup Guide</a></li>
            
            
            
            
            
            
            <li><a href="/docs/get-started/quickstart-tutorial">Quickstart Tutorial</a></li>
            
            
            
            
            
            
            <li><a href="/docs/get-started/grakn-server">Grakn Server</a></li>
            
            
            
            
            
            
            <li><a href="/docs/get-started/graql-console">Graql Console</a></li>
            
            
            
            
        </ul>
        
        
    
    <li>
        <a href="#">Knowledge Model</a>
        <ul>
            
            
            
            <li><a href="/docs/knowledge-model/model">The Model</a></li>
            
            
            
            
            
            
            <li><a href="/docs/knowledge-model/data">The Data</a></li>
            
            
            
            
            
            
            <li><a href="/docs/knowledge-model/inference">The Inference</a></li>
            
            
            
            
        </ul>
        
        
    
    <li>
        <a href="#">Building Schema</a>
        <ul>
            
            
            
            <li><a href="/docs/building-schema/defining-schema">Defining Schema</a></li>
            
            
            
            
            
            
            <li><a href="/docs/building-schema/defining-rules">Defining Rules</a></li>
            
            
            
            
            
            
            <li><a href="/docs/building-schema/querying-schema">Querying Schema</a></li>
            
            
            
            
            
            
            <li><a href="/docs/building-schema/basic-schema">Example: Basic Schema</a></li>
            
            
            
            
            
            
            <li><a href="/docs/building-schema/hierarchical-schema">Example: Hierarchical Schema</a></li>
            
            
            
            
            
            
            <li><a href="/docs/building-schema/rule-driven-schema">Example: Rule-Driven Schema</a></li>
            
            
            
            
        </ul>
        
        
    
    <li>
        <a href="#">Querying Data</a>
        <ul>
            
            
            
            <li><a href="/docs/querying-data/overview">Overview</a></li>
            
            
            
            
            
            
            <li><a href="/docs/querying-data/match-clause">Match Clause</a></li>
            
            
            
            
            
            
            <li><a href="/docs/querying-data/get-queries">Get Queries</a></li>
            
            
            
            
            
            
            <li><a href="/docs/querying-data/insert-queries">Insert Queries</a></li>
            
            
            
            
            
            
            <li><a href="/docs/querying-data/delete-queries">Delete Queries</a></li>
            
            
            
            
            
            
            <li><a href="/docs/querying-data/aggregate-queries">Aggregate Queries</a></li>
            
            
            
            
        </ul>
        
        
    
    <li>
        <a href="#">Distributed Analytics</a>
        <ul>
            
            
            
            <li><a href="/docs/distributed-analytics/overview">Overview</a></li>
            
            
            
            
            
            
            <li><a href="/docs/distributed-analytics/compute-queries">Compute Queries</a></li>
            
            
            
            
            
            
            <li><a href="/docs/distributed-analytics/compute-statistics">Statistics</a></li>
            
            
            
            
            
            
            <li><a href="/docs/distributed-analytics/compute-shortest-path">Shortest Path</a></li>
            
            
            
            
            
            
            <li><a href="/docs/distributed-analytics/compute-degrees">Degrees</a></li>
            
            
            
            
            
            
            <li><a href="/docs/distributed-analytics/compute-connected-components">Connected Components</a></li>
            
            
            
            
        </ul>
        
        
    
    <li>
        <a href="#">Migrating Data</a>
        <ul>
            
            
            
            <li><a href="/docs/migrating-data/overview">Overview</a></li>
            
            
            
            
            
            
            <li><a href="/docs/migrating-data/migration-language">Language</a></li>
            
            
            
            
            
            
            <li><a href="/docs/migrating-data/migrating-csv">Migrating CSV</a></li>
            
            
            
            
            
            
            <li><a href="/docs/migrating-data/migrating-json">Migrating JSON</a></li>
            
            
            
            
            
            
            <li><a href="/docs/migrating-data/migrating-sql">Migrating SQL</a></li>
            
            
            
            
            
            
            <li><a href="/docs/migrating-data/migrating-xml">Migrating XML</a></li>
            
            
            
            
        </ul>
        
        
    
    <li>
        <a href="#">Visualisation Dashboard</a>
        <ul>
            
            
            
            <li><a href="/docs/visualisation-dashboard/visualiser">Grakn Visualiser</a></li>
            
            
            
            
        </ul>
        
        
    
    <li>
        <a href="#">Java Library</a>
        <ul>
            
            
            
            <li><a href="/docs/java-library/setup">Setup</a></li>
            
            
            
            
            
            
            <li><a href="/docs/java-library/core-api">Core API</a></li>
            
            
            
            
            
            
            <li><a href="/docs/java-library/graql-api">Graql API</a></li>
            
            
            
            
            
            
            <li><a href="/docs/java-library/migration-api">Migration API</a></li>
            
            
            
            
            
            
            <li><a href="/docs/java-library/loader-api">Loader API</a></li>
            
            
            
            
            
            
            <li><a href="/docs/java-library/advanced">Advanced</a></li>
            
            
            
            
        </ul>
        
        
    
    <li>
        <a href="#">Language Drivers</a>
        <ul>
            
            
            
            <li><a href="/docs/language-drivers/grakn-python">Python</a></li>
            
            
            
            
            
            
            <li><a href="/docs/language-drivers/grakn-haskell">Haskell</a></li>
            
            
            
            
        </ul>
        
        
    
    <li>
        <a href="#">API References</a>
        <ul>
            
            
            
            <li><a href="/docs/api-references/ddl">Data Definition Language</a></li>
            
            
            
            
            
            
            <li><a href="/docs/api-references/dml">Data Manipulation Language</a></li>
            
            
            
            
            
            
            <li><a href="/docs/api-references/rest-api">REST API</a></li>
            
            
            
            
            
            
            <li><a href="/docs/api-references/graql-cheatsheet">Graql Cheatsheet</a></li>
            
            
            
            
            
            
            <li><a href="//javadoc.io/doc/ai.grakn/grakn" target="_blank">Javadocs</a></li>
            
            
            
            
        </ul>
        
        
    
    <li>
        <a href="#">Resources</a>
        <ul>
            
            
            
            <li><a href="/docs/resources/overview">Overview</a></li>
            
            
            
            
            
            
            <li><a href="/docs/resources/faq">Grakn FAQ</a></li>
            
            
            
            
            
            
            <li><a href="/docs/resources/downloads">Downloads</a></li>
            
            
            
            
        </ul>
        
        
    
    <li>
        <a href="#">Examples</a>
        <ul>
            
            
            
            <li><a href="/docs/examples/examples-overview">Overview</a></li>
            
            
            
            
            
            
            <li><a href="/docs/examples/CSV-migration">CSV Migration</a></li>
            
            
            
            
            
            
            <li><a href="/docs/examples/SQL-migration">SQL Migration</a></li>
            
            
            
            
            
            
            <li><a href="/docs/examples/graql-reasoning">Reasoning with Graql</a></li>
            
            
            
            
            
            
            <li class="active"><a href="/docs/examples/working-with-tweets">Working With Tweets</a></li>
            
            
            
            
            
            
            <li><a href="/docs/examples/modern">Modern example</a></li>
            
            
            
            
            
            
            <li><a href="/docs/examples/pokemon">Pokemon example</a></li>
            
            
            
            
            
            
            <li><a href="/docs/examples/analytics">Statistical Analysis</a></li>
            
            
            
            
            
            
            <li><a href="/docs/examples/java-api-example">API for Java developers</a></li>
            
            
            
            
            
            
            <li><a href="/docs/examples/java-analytics">Analytics using Java APIs</a></li>
            
            
            
            
            
            
            <li><a href="/docs/examples/projects">Example Projects</a></li>
            
            
            
            
        </ul>
        
        

        
        <li>
            
            <li><a href="/contributors/index">Contribute to GRAKN.AI</a></li>
            
        </li>
        
        <li>
            
            <li><a href="/academy/index">Grakn Academy</a></li>
            
        </li>
        
        
        <!-- if you aren't using the accordion, uncomment this block:
           <p class="external">
               <a href="#" id="collapseAll">Collapse All</a> | <a href="#" id="expandAll">Expand All</a>
           </p>
           -->
    </li>
</ul>

<!-- this highlights the active parent class in the navgoco sidebar. this is critical so that the parent expands when you're viewing a page. This must appear below the sidebar code above. Otherwise, if placed inside customscripts.js, the script runs before the sidebar code runs and the class never gets inserted.-->
<script>$("li.active").parents('li').toggleClass("active");</script>

        </div>
        <!-- Content Column -->
        <div class="col-md-9 col-content">
            <div class="post-header">
   <h1 class="post-title-main">Working With Tweets</h1>
</div>



<div class="post-content">

   
    <div class="summary">An example which demonstrates key Grakn concepts in a practical setting</div>
   

    
    

<!-- this handles the automatic toc. use ## for subheads to auto-generate the on-page minitoc. if you use html tags, you must supply an ID for the heading element in order for it to appear in the minitoc. -->
<script>
$( document ).ready(function() {
  // Handler for .ready() called.

$('#toc').toc({ minimumHeaders: 0, listType: 'ul', showSpeed: 0, headers: 'h2' });

/* this offset helps account for the space taken up by the floating toolbar. */
$('#toc').on('click', 'a', function() {
  var target = $(this.getAttribute('href'))
    , scroll_target = target.offset().top

  $(window).scrollTop(scroll_target - 10);
  return false
})

});
</script>

<div id="toc"></div>

    

    

    

    

  <h1 id="working-with-tweets">Working With Tweets</h1>
<p>In this tutorial we will look at how to stream public tweets into Grakn’s knowledge base. The tutorial aims to demonstrate key concepts such as receiving, inserting and querying data. Upon the completion of this tutorial, you will have learnt about these concepts:</p>

<ul>
  <li>Defining a simple Grakn.ai schema using the Java API</li>
  <li>Streaming public tweets into the application with the <a href="http://twitter4j.org/" title="Twitter4J">Twitter4J</a> library</li>
  <li>Inserting tweets into the knowledge base using Grakn’s Java API</li>
  <li>Performing simple queries using Graql, the Grakn’s query language</li>
</ul>

<p>A fully working example of this tutorial can be found in the <a href="https://github.com/graknlabs/sample-projects/tree/master/example-working-with-tweets">sample-projects repository</a>.</p>
<h2 id="registering-your-own-twitter-application">Registering Your Own Twitter Application</h2>
<p>As of today, every endpoint in the Twitter API is authenticated. Therefore, you must own a Twitter application (or, register a new one) before proceeding further.</p>

<p>You can register your own application in the <a href="https://apps.twitter.com/">Twitter Application Management</a>. Once you’ve done so you can  get the credentials by visiting the <strong>Keys and Access Tokens</strong> tab. The value we care about in particular are Consumer Key, Consumer Secret, Access Token, and Access Token Secret.</p>

<h2 id="bootstraping-the-skeleton-project">Bootstraping The Skeleton Project</h2>
<p>Let’s bootstrap a new maven project! Hit the command line and run the following command to generate a new maven project:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mvn archetype:generate <span class="nt">-DgroupId</span><span class="o">=</span>ai.grakn <span class="nt">-DartifactId</span><span class="o">=</span>twitterexample <span class="nt">-DarchetypeArtifactId</span><span class="o">=</span>maven-archetype-quickstart <span class="nt">-DinteractiveMode</span><span class="o">=</span><span class="nb">false</span>
</code></pre></div></div>

<p>Now that you have basic project structure and <code class="highlighter-rouge">pom.xml</code> in place, let’s start customising them to our needs. We will add two things to the <code class="highlighter-rouge">&lt;build&gt;</code> section:</p>

<ol>
  <li><code class="highlighter-rouge">maven-compiler-plugin</code> configuration in order to enable lambda and other nifty Java 8 features</li>
  <li><code class="highlighter-rouge">maven-shade-plugin</code> configuration which points to our <code class="highlighter-rouge">Main</code> class, for creating a fat JAR.</li>
</ol>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;build&gt;</span>
    <span class="nt">&lt;plugins&gt;</span>
        <span class="nt">&lt;plugin&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.apache.maven.plugins<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>maven-compiler-plugin<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;configuration&gt;</span>
                <span class="nt">&lt;source&gt;</span>1.8<span class="nt">&lt;/source&gt;</span>
                <span class="nt">&lt;target&gt;</span>1.8<span class="nt">&lt;/target&gt;</span>
            <span class="nt">&lt;/configuration&gt;</span>
        <span class="nt">&lt;/plugin&gt;</span>
        <span class="nt">&lt;plugin&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.apache.maven.plugins<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>maven-shade-plugin<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>2.3<span class="nt">&lt;/version&gt;</span>
            <span class="nt">&lt;configuration&gt;</span>
                <span class="nt">&lt;createDependencyReducedPom&gt;</span>true<span class="nt">&lt;/createDependencyReducedPom&gt;</span>
                <span class="nt">&lt;filters&gt;</span>
                    <span class="nt">&lt;filter&gt;</span>
                        <span class="nt">&lt;artifact&gt;</span>*:*<span class="nt">&lt;/artifact&gt;</span>
                        <span class="nt">&lt;excludes&gt;</span>
                            <span class="nt">&lt;exclude&gt;</span>META-INF/*.SF<span class="nt">&lt;/exclude&gt;</span>
                            <span class="nt">&lt;exclude&gt;</span>META-INF/*.DSA<span class="nt">&lt;/exclude&gt;</span>
                            <span class="nt">&lt;exclude&gt;</span>META-INF/*.RSA<span class="nt">&lt;/exclude&gt;</span>
                        <span class="nt">&lt;/excludes&gt;</span>
                    <span class="nt">&lt;/filter&gt;</span>
                <span class="nt">&lt;/filters&gt;</span>
            <span class="nt">&lt;/configuration&gt;</span>
            <span class="nt">&lt;executions&gt;</span>
                <span class="nt">&lt;execution&gt;</span>
                    <span class="nt">&lt;phase&gt;</span>package<span class="nt">&lt;/phase&gt;</span>
                    <span class="nt">&lt;goals&gt;</span>
                        <span class="nt">&lt;goal&gt;</span>shade<span class="nt">&lt;/goal&gt;</span>
                    <span class="nt">&lt;/goals&gt;</span>
                    <span class="nt">&lt;configuration&gt;</span>
                        <span class="nt">&lt;transformers&gt;</span>
                            <span class="nt">&lt;transformer</span> <span class="na">implementation=</span><span class="s">"org.apache.maven.plugins.shade.resource.ServicesResourceTransformer"</span><span class="nt">/&gt;</span>
                            <span class="nt">&lt;transformer</span> <span class="na">implementation=</span><span class="s">"org.apache.maven.plugins.shade.resource.ManifestResourceTransformer"</span><span class="nt">&gt;</span>
                                <span class="nt">&lt;mainClass&gt;</span>ai.grakn.twitterexample.Main<span class="nt">&lt;/mainClass&gt;</span>
                            <span class="nt">&lt;/transformer&gt;</span>
                        <span class="nt">&lt;/transformers&gt;</span>
                    <span class="nt">&lt;/configuration&gt;</span>
                <span class="nt">&lt;/execution&gt;</span>
            <span class="nt">&lt;/executions&gt;</span>
        <span class="nt">&lt;/plugin&gt;</span>
    <span class="nt">&lt;/plugins&gt;</span>
<span class="nt">&lt;/build&gt;</span>
</code></pre></div></div>

<p>Then continue to the <code class="highlighter-rouge">&lt;dependencies&gt;</code> section and make sure you have all the required dependencies, i.e., <code class="highlighter-rouge">grakn-kb</code>, <code class="highlighter-rouge">twitter4j-core</code>, and <code class="highlighter-rouge">twitter4j-stream</code>:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;dependencies&gt;</span>
    <span class="nt">&lt;dependency&gt;</span>
        <span class="nt">&lt;groupId&gt;</span>ai.grakn<span class="nt">&lt;/groupId&gt;</span>
        <span class="nt">&lt;artifactId&gt;</span>grakn-kb<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;version&gt;&lt;Current</span> <span class="err">Grakn</span> <span class="err">Version</span><span class="nt">&gt;&lt;/version&gt;</span>
    <span class="nt">&lt;/dependency&gt;</span>

    <span class="nt">&lt;dependency&gt;</span>
        <span class="nt">&lt;groupId&gt;</span>org.twitter4j<span class="nt">&lt;/groupId&gt;</span>
        <span class="nt">&lt;artifactId&gt;</span>twitter4j-core<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;version&gt;&lt;Current</span> <span class="err">Twitter4j</span> <span class="err">Core</span> <span class="err">Version</span><span class="nt">&gt;&lt;/version&gt;</span>
    <span class="nt">&lt;/dependency&gt;</span>

    <span class="nt">&lt;dependency&gt;</span>
        <span class="nt">&lt;groupId&gt;</span>org.twitter4j<span class="nt">&lt;/groupId&gt;</span>
        <span class="nt">&lt;artifactId&gt;</span>twitter4j-stream<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;version&gt;&lt;Current</span> <span class="err">Twitter4j</span> <span class="err">Stream</span> <span class="err">Version</span><span class="nt">&gt;&lt;/version&gt;</span>
    <span class="nt">&lt;/dependency&gt;</span>
<span class="nt">&lt;/dependencies&gt;</span>
</code></pre></div></div>

<h2 id="the-main-class">The Main Class</h2>

<p>Let’s kick things off by defining a <code class="highlighter-rouge">Main</code> class inside the <code class="highlighter-rouge">ai.grakn.twitterexample</code> package. Aside from Twitter credentials, it contains a few important Grakn settings.</p>

<p>First, we have decided to use an <strong>in-memory knowledge base</strong> for simplicity’s sake — working with an in-memory knowledge base frees us from having to set up a Grakn distribution in the local machine. The in-memory graph is not for storing data and will be lost once the program finishes execution. Second, the graph will be stored in a <strong>keyspace</strong> named <code class="highlighter-rouge">twitter-example</code>.</p>

<!-- A lot of these examples are not valid Groovy, so they've been ignored in tests -->
<pre><code class="language-java-test-ignore">package ai.grakn.twitterexample;

import ai.grakn.Grakn;
import ai.grakn.GraknSession;

public class Main {
  // Twitter credentials
  private static final String consumerKey = "...";
  private static final String consumerSecret = "...";
  private static final String accessToken = "...";
  private static final String accessTokenSecret = "...";

  // Grakn settings
  private static final String implementation = Grakn.IN_MEMORY;
  private static final String keyspace = "twitter-example";

  public static void main(String[] args) {
    // our code will go here
  }
}
</code></pre>

<p>We then define a <code class="highlighter-rouge">GraknSession</code> object in <code class="highlighter-rouge">main()</code>. Enclosing it in a <code class="highlighter-rouge">try-with-attribute</code> construct is a good practice, lest we forget closing the session by calling <code class="highlighter-rouge">session.close()</code>.</p>

<pre><code class="language-java-test-ignore">public static void main(String[] args) {
  try (GraknSession session = Grakn.session(implementation, keyspace)) {
    // our code will go here
  }
}
</code></pre>

<p>Following that, another equally important object for operating on the knowledge base is <code class="highlighter-rouge">GraknTx</code>. After performing the operations we desire, we must not forget to commit. For convenience, let’s define a helper method which opens a <code class="highlighter-rouge">GraknTx</code> in write mode, and commits it after executing the function <code class="highlighter-rouge">fn</code>. We will be using this function in various places throughout the tutorial.</p>

<pre><code class="language-java-test-ignore">public class GraknTweetSchemaHelper {
  public static void withGraknTx(GraknSession session, Consumer&lt;GraknTx&gt; fn) {
    GraknTx tx = session.open(GraknTxType.WRITE);
    fn.accept(tx);
    tx.commit();
  }
}
</code></pre>

<p>We have decided to omit exception handling to keep the tutorial simple. In production code however, it will be very important and must not be forgotten.</p>

<h2 id="defining-the-schema">Defining The Schema</h2>

<p>Let’s define the schema. As we are mainly interested in both the <strong>tweet</strong> and <strong>who posted the tweet</strong>, let us capture these concepts by defining two <strong>entity types</strong>: <code class="highlighter-rouge">user</code> and <code class="highlighter-rouge">tweet</code>.</p>

<p>The <code class="highlighter-rouge">user</code> entity will hold the user’s actual username in a <strong>attribute</strong> called <code class="highlighter-rouge">screen_name</code>, while the <code class="highlighter-rouge">tweet</code> entity will contain the user’s tweet in another attribute called <code class="highlighter-rouge">text</code>. We will also define an attribute <code class="highlighter-rouge">identifier</code> for the id.</p>

<p>Next we will define two <strong>roles</strong> - <code class="highlighter-rouge">posts</code> and <code class="highlighter-rouge">posted_by</code> to express that a <code class="highlighter-rouge">user</code> posts a <code class="highlighter-rouge">tweet</code>, and similarly, a <code class="highlighter-rouge">tweet</code> is posted by a <code class="highlighter-rouge">user</code>. We will tie this two roles by a <strong>relationship</strong> called <code class="highlighter-rouge">user-tweet-relationship</code>.</p>

<p>The structure can be summarized by the following image:</p>

<p><img src="/images/working-with-tweets-schema.jpg" alt="Schema" /></p>

<p>With that set, let’s define a new method <code class="highlighter-rouge">initTweetSchema</code> inside <code class="highlighter-rouge">GraknTweetSchemaHelper</code> class and define our schema creation there.</p>

<pre><code class="language-java-test-ignore">public class GraknTweetSchemaHelper {
  public static void initTweetSchema(GraknTx tx) {

  }
}
</code></pre>

<p>Start by defining our attributes:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// attributes</span>
<span class="n">AttributeType</span> <span class="n">idType</span> <span class="o">=</span> <span class="n">tx</span><span class="o">.</span><span class="na">putAttributeType</span><span class="o">(</span><span class="s">"identifier"</span><span class="o">,</span> <span class="n">AttributeType</span><span class="o">.</span><span class="na">DataType</span><span class="o">.</span><span class="na">STRING</span><span class="o">);</span>
<span class="n">AttributeType</span> <span class="n">textType</span> <span class="o">=</span> <span class="n">tx</span><span class="o">.</span><span class="na">putAttributeType</span><span class="o">(</span><span class="s">"text"</span><span class="o">,</span> <span class="n">AttributeType</span><span class="o">.</span><span class="na">DataType</span><span class="o">.</span><span class="na">STRING</span><span class="o">);</span>
<span class="n">AttributeType</span> <span class="n">screenNameType</span> <span class="o">=</span> <span class="n">tx</span><span class="o">.</span><span class="na">putAttributeType</span><span class="o">(</span><span class="s">"screen_name"</span><span class="o">,</span> <span class="n">AttributeType</span><span class="o">.</span><span class="na">DataType</span><span class="o">.</span><span class="na">STRING</span><span class="o">);</span>
</code></pre></div></div>

<p>Entities:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// entities</span>
<span class="n">EntityType</span> <span class="n">tweetType</span> <span class="o">=</span> <span class="n">tx</span><span class="o">.</span><span class="na">putEntityType</span><span class="o">(</span><span class="s">"tweet"</span><span class="o">);</span>
<span class="n">EntityType</span> <span class="n">userType</span> <span class="o">=</span> <span class="n">tx</span><span class="o">.</span><span class="na">putEntityType</span><span class="o">(</span><span class="s">"user"</span><span class="o">);</span>
</code></pre></div></div>

<p>Roles and relationships:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// roles</span>
<span class="n">Role</span> <span class="n">postsType</span> <span class="o">=</span> <span class="n">tx</span><span class="o">.</span><span class="na">putRole</span><span class="o">(</span><span class="s">"posts"</span><span class="o">);</span>
<span class="n">Role</span> <span class="n">postedByType</span> <span class="o">=</span> <span class="n">tx</span><span class="o">.</span><span class="na">putRole</span><span class="o">(</span><span class="s">"posted_by"</span><span class="o">);</span>

<span class="c1">// relationships</span>
<span class="n">RelationshipType</span> <span class="n">userTweetRelationType</span> <span class="o">=</span> <span class="n">tx</span><span class="o">.</span><span class="na">putRelationshipType</span><span class="o">(</span><span class="s">"user-tweet-relationship"</span><span class="o">).</span><span class="na">relates</span><span class="o">(</span><span class="n">postsType</span><span class="o">).</span><span class="na">relates</span><span class="o">(</span><span class="n">postedByType</span><span class="o">);</span>
</code></pre></div></div>

<p>And finally, assign attributes and roles appropriately.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// attribute and relationship assignments</span>
<span class="n">tweetType</span><span class="o">.</span><span class="na">attribute</span><span class="o">(</span><span class="n">idType</span><span class="o">);</span>
<span class="n">tweetType</span><span class="o">.</span><span class="na">attribute</span><span class="o">(</span><span class="n">textType</span><span class="o">);</span>
<span class="n">userType</span><span class="o">.</span><span class="na">attribute</span><span class="o">(</span><span class="n">screenNameType</span><span class="o">);</span>
<span class="n">userType</span><span class="o">.</span><span class="na">plays</span><span class="o">(</span><span class="n">postsType</span><span class="o">);</span>
<span class="n">tweetType</span><span class="o">.</span><span class="na">plays</span><span class="o">(</span><span class="n">postedByType</span><span class="o">);</span>
</code></pre></div></div>

<p>Now invoke the method in <code class="highlighter-rouge">main</code> so the schema is created at the start of the application.</p>

<pre><code class="language-java-test-ignore">public static void main(String[] args) {
  try (GraknSession session = Grakn.session(implememntation, keyspace)) {
    withGraknTx(session, tx -&gt; initTweetSchema(tx)); // initialize schema
  }
}
</code></pre>

<h2 id="streaming-data-from-twitter">Streaming Data From Twitter</h2>

<p>Now that we’re done with schema creation, let’s develop the code for listening to the public tweet stream.</p>

<p>Define a new method <code class="highlighter-rouge">listenToTwitterStreamAsync </code> and put it in a class named <code class="highlighter-rouge">AsyncTweetStreamProcessorHelper </code>.  In addition to accepting Twitter credential settings, we will also need to supply a callback <code class="highlighter-rouge">onTweetReceived</code>, will be invoked whenever the application receives a new tweet. Further down, we will use this callback for storing, querying and displaying tweets as they come.</p>

<pre><code class="language-java-test-ignore">public class AsyncTweetStreamProcessorHelper {
  public static TwitterStream listenToTwitterStreamAsync(String consumerKey, String consumerSecret, String accessToken, String accessTokenSecret, BiConsumer&lt;String, String&gt; onTweetReceived) {
    final String DEFAULT_LANGUAGE = "en";
    // ...
  }
}
</code></pre>

<p>The first thing we need to do here is to create a <code class="highlighter-rouge">Configuration</code> object out of the Twitter credential settings. Let’s write a dedicated method just for that and name it <code class="highlighter-rouge">createTwitterConfiguration</code>. Afterwards, use that method to create the <code class="highlighter-rouge">Configuration</code> object which we will need in <code class="highlighter-rouge">listenToTwitterStreamAsync</code>.</p>

<pre><code class="language-java-test-ignore">public class AsyncTweetStreamProcessorHelper {
  public static TwitterStream listenToTwitterStreamAsync(String consumerKey, String consumerSecret, String accessToken, String accessTokenSecret, BiConsumer&lt;String, String&gt; onTweetReceived) {
    final String DEFAULT_LANGUAGE = "en";
    Configuration conf = createTwitterConfiguration(consumerKey, consumerSecret, accessToken, accessTokenSecret);
    // ...
  }

  private static Configuration createTwitterConfiguration(String consumerKey, String consumerSecret, String accessToken, String accessTokenSecret) {
    return new ConfigurationBuilder()
        .setDebugEnabled(false)
        .setOAuthConsumerKey(consumerKey)
        .setOAuthConsumerSecret(consumerSecret)
        .setOAuthAccessToken(accessToken)
        .setOAuthAccessTokenSecret(accessTokenSecret)
        .build();
  }
}
</code></pre>

<p>Next we will create a private class <code class="highlighter-rouge">TweetListener</code> and make it implement the <code class="highlighter-rouge">StatusListener</code> interface from Twitter4J. This interface has a bunch of methods we can override depending on what we want to receive from Twitter. As we only care about receiving tweet updates and nothing else, we only need to override a single method <code class="highlighter-rouge">onStatus</code>.</p>

<p>The constructor of our <code class="highlighter-rouge">TweetListener</code> class accepts a callback <code class="highlighter-rouge">onStatusReceived</code> which will be executed  every time we receive a new tweet.</p>

<p>Once we’re done defining the class let’s come back to <code class="highlighter-rouge">listenToTwitterStreamAsync</code> and instantiate it. We will also instantiate two other classes, <code class="highlighter-rouge">TwitterStreamFactory</code> and <code class="highlighter-rouge">TwitterStream</code>. Now we can start listening to Twitter by calling the <code class="highlighter-rouge">sample</code> method. We supplied <code class="highlighter-rouge">"en"</code> which means we are only interested in English tweets.</p>

<pre><code class="language-java-test-ignore">public class AsyncTweetStreamProcessorHelper {
  public static TwitterStream listenToTwitterStreamAsync(String consumerKey, String consumerSecret, String accessToken, String accessTokenSecret, BiConsumer&lt;String, String&gt; onTweetReceived) {
    final String DEFAULT_LANGUAGE = "en";

    Configuration conf = createTwitterConfiguration(consumerKey, consumerSecret, accessToken, accessTokenSecret);
    TweetListener tweetListener = new TweetListener(onTweetReceived);

    TwitterStreamFactory twitterStreamFactory = new TwitterStreamFactory(conf);
    TwitterStream twitterStreamSingleton = twitterStreamFactory.getInstance();
    twitterStreamSingleton.addListener(tweetListener);

    twitterStreamSingleton.sample(DEFAULT_LANGUAGE);

    return twitterStreamSingleton;
  }

// An implementation which implements twitter4j's StatusListener
class TweetListener implements StatusListener {
  public TweetListener(BiConsumer&lt;String, String&gt; onStatusReceived) {
    this.onStatusReceived = onStatusReceived;
  }

  public void onStatus(Status status) {
    onStatusReceived.accept(status.getUser().getScreenName(), status.getText());
  }
  public void onException(Exception ex) {
    ex.printStackTrace();
  }

  // a bunch of empty event handler implementations, we're not using them
  public void onDeletionNotice(StatusDeletionNotice statusDeletionNotice) {}
  public void onTrackLimitationNotice(int numberOfLimitedStatuses) {}
  public void onScrubGeo(long lat, long long_) {}
  public void onStallWarning(StallWarning stallWarning) {}

  private BiConsumer&lt;String, String&gt; onStatusReceived;
}
</code></pre>

<p>Let’s wrap up this section by adding the call to <code class="highlighter-rouge">listenToTwitterStreamAsync</code> into <code class="highlighter-rouge">main</code>.</p>

<pre><code class="language-java-test-ignore">public static void main(String[] args) {
  try (GraknSession session = Grakn.session(implementation, keyspace)) {
    withGraknTx(session, tx -&gt; initTweetSchema(tx)); // initialize schema

    listenToTwitterStreamAsync(consumerKey, consumerSecret, accessToken, accessTokenSecret, (screenName, tweet) -&gt; {
      // TODO: do something upon receiving a new tweet
    });
  }
}
</code></pre>

<h2 id="inserting-tweets-into-the-knowledge-base">Inserting Tweets Into The Knowledge Base</h2>

<p>At this point our little program already has a clearly defined schema, and is able to listen to incoming tweets. However, we have yet to decide what exactly we’re going to do with them. In this section we will have a look at how to:</p>

<ol>
  <li>Insert an incoming tweet into the knowledge base</li>
  <li>Insert a user who posted the tweet, only once — we don’t want to insert the same user twice</li>
  <li>Maintain an association between a tweet and the user</li>
</ol>

<p>We will be using the java API for inserting the data in the knowledge base because it is lightweight and efficient.</p>

<h3 id="insert-a-tweet">Insert A Tweet</h3>

<p>To insert a tweet, we must create a <code class="highlighter-rouge">tweet</code> entity and a <code class="highlighter-rouge">text</code> attribute to hold the tweet’s textual data, before associating said attribute with the entity.</p>

<p>Let’s do that with a new method. It will accept a single <code class="highlighter-rouge">String</code> and inserts it into the knowledge base, before returning the <code class="highlighter-rouge">Entity</code> of said tweet.</p>

<p>Pay attention to how we need to retrieve the <code class="highlighter-rouge">EntityTypes</code> and <code class="highlighter-rouge">AttributeTypes</code> of entity and attribute we are interested in — we need them in order to perform the actual insertion.</p>

<pre><code class="language-java-test-ignore">public static Entity insertTweet(GraknTx tx, String tweet) {
    EntityType tweetEntityType = tx.getEntityType("tweet");
    AttributeType tweetResouceType = tx.getAttributeType("text");

    Entity tweetEntity = tweetEntityType.addEntity();
    Attribute tweetAttribute = tweetResouceType.putAttribute(tweet);

    return tweetEntity.attribute(tweetAttribute);
  }
</code></pre>

<h3 id="insert-a-user">Insert A User</h3>

<p>In addition to the tweet, we also want to store who posted the tweet. A semantic we need to enforce is to insert a particular user only once, i.e., it doesn’t make sense to store the same user twice.</p>

<p>Therefore, let’s add a method for checking whether we’ve previously stored a particular user. We will be using Java 8’s <code class="highlighter-rouge">Optional&lt;T&gt;</code>, where we return the <code class="highlighter-rouge">Entity</code> object of that user only if it exists in the knowledge base. Otherwise, an <code class="highlighter-rouge">Optional.empty()</code> will be returned.</p>

<pre><code class="language-java-test-ignore">public static Optional&lt;Entity&gt; findUser(QueryBuilder queryBuilder, String user) {
  Match findUser = queryBuilder.match(var("x").isa("user").has("screen_name", user)).limit(1);
  Iterator&lt;Concept&gt; concepts = findUser.get("x").iterator();
  if (concepts.hasNext()) {
    Entity entity = concepts.next().asEntity();
    return Optional.of(entity);
  }
  else return Optional.empty();
}
</code></pre>

<p>And the following method for inserting a user. This one is quite similar to the one we made for inserting a tweet.</p>

<pre><code class="language-java-test-ignore">public static Entity insertUser(GraknTx tx, String user) {
  EntityType userEntityType = tx.getEntityType("user");
  AttributeType userAttributeType = tx.getAttributeType("screen_name");
  Entity userEntity = userEntityType.addEntity();
  Attribute userAttribute = userAttributeType.putAttribute(user);
  return userEntity.attribute(userAttribute);
}
</code></pre>

<p>And finally, write a function for inserting a user only if it’s not yet there in the knowledge base.</p>

<pre><code class="language-java-test-ignore">public static Entity insertUserIfNotExist(GraknTx tx, String screenName) {
  QueryBuilder qb = tx.graql();
  return findUser(qb, screenName).orElse(insertUser(tx, screenName));
}
</code></pre>

<h3 id="relating-the-tweet-to-the-user">Relating The Tweet To The User</h3>

<p>We’re almost there with a complete tweet insertion functionality! There’s only one thing left to do which is to relate the <code class="highlighter-rouge">tweet</code> entity with the <code class="highlighter-rouge">user</code> entity. Preserving this connection is crucial, after all.</p>

<p>The following function will create a relationship between the user and tweet that we specify.</p>

<pre><code class="language-java-test-ignore">public static Relationship insertUserTweetRelation(GraknTx tx, Entity user, Entity tweet) {
  RelationType userTweetRelationType = tx.getRelationType("user-tweet-relationship");
  RoleType postsType = tx.getRoleType("posts");
  RoleType postedByType = tx.getRoleType("posted_by");

  Relationship userTweetRelation = userTweetRelationType.addRelationship()
      .addRolePlayer(postsType, user)
      .addRolePlayer(postedByType, tweet);

  return userTweetRelation;
}
</code></pre>

<h3 id="tweet-insertion-wrap-up">Tweet Insertion Wrap Up</h3>

<p>Finally, let’s wrap up by defining a function of which the sole responsibility is to execute all of the methods we have defined above.</p>

<pre><code class="language-java-test-ignore">public static Relationship insertUserTweet(GraknTx tx, String screenName, String tweet) {
  Entity tweetEntity = insertTweet(tx, tweet);
  Entity userEntity = insertUserIfNotExist(tx, screenName);
  return insertUserTweetRelation(tx, userEntity, tweetEntity);
}
</code></pre>

<p>We’re done with tweet insertion functionality! Next step: querying the stored data. Before we proceed, let’s add the method we’ve just defined to the main method as shown below.</p>

<pre><code class="language-java-test-ignore">public static void main(String[] args) {
  try (GraknSession session = Grakn.session(implementation, keyspace)) {
    withGraknTx(session, tx -&gt; initTweetSchema(tx)); // initialize schema

    listenToTwitterStreamAsync(consumerKey, consumerSecret, accessToken, accessTokenSecret, (screenName, tweet) -&gt; {
      withGraknTx(session, tx -&gt; insertUserTweet(tx, screenName, tweet)); // insert tweet
      // TODO: perform some meaningful queries on the inserted data
    });
  }

</code></pre>

<h2 id="crafting-simple-queries-using-graql">Crafting Simple Queries Using Graql</h2>

<p>We will perform a query which will count the number of tweets a user has posted since the program started. It can be achieved by utilizing the aggregate query feature. Graql has been chosen over the java API for this task because it is declarative and therefore much easier to use for complex queries.</p>

<p>Let’s look at how we can build it step-by-step, start by creating a <code class="highlighter-rouge">QueryBuilder</code> object which we will use to craft the query in Graql.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">QueryBuilder</span> <span class="n">qb</span> <span class="o">=</span> <span class="n">tx</span><span class="o">.</span><span class="na">graql</span><span class="o">();</span>
</code></pre></div></div>

<p>Now let’s begin crafting the query. For this tutorial, let’s create a <code class="highlighter-rouge">match</code> query where we retrieve both the <code class="highlighter-rouge">user</code> and <code class="highlighter-rouge">tweet</code>.</p>

<p>We will bind them into <code class="highlighter-rouge">var</code>s which will be named <code class="highlighter-rouge">user</code> and <code class="highlighter-rouge">tweet</code>, respectively. Notice how we deliberately assign the <code class="highlighter-rouge">var</code>s  identical names as the respective entity types. This is not a necessity and in practice, you are free to name them anything you want.</p>

<p>Also, pay attention to how we also supply the <code class="highlighter-rouge">user-tweet-relationship</code> relationship as part of the condition.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">qb</span><span class="o">.</span><span class="na">match</span><span class="o">(</span>
  <span class="n">var</span><span class="o">(</span><span class="s">"user"</span><span class="o">).</span><span class="na">isa</span><span class="o">(</span><span class="s">"user"</span><span class="o">),</span>
  <span class="n">var</span><span class="o">(</span><span class="s">"tweet"</span><span class="o">).</span><span class="na">isa</span><span class="o">(</span><span class="s">"tweet"</span><span class="o">),</span>
  <span class="n">var</span><span class="o">().</span><span class="na">rel</span><span class="o">(</span><span class="s">"posts"</span><span class="o">,</span> <span class="s">"user"</span><span class="o">).</span><span class="na">rel</span><span class="o">(</span><span class="s">"posted_by"</span><span class="o">,</span> <span class="s">"tweet"</span><span class="o">).</span><span class="na">isa</span><span class="o">(</span><span class="s">"user-tweet-relationship"</span><span class="o">));</span>
</code></pre></div></div>

<p>The query we’ve just defined will return every user and tweet along with their relationships. We will use it as the basis of the aggregate query.</p>

<p>Let’s do some aggregation over the result here. We will supply <code class="highlighter-rouge">"user"</code> and <code class="highlighter-rouge">count()</code> as the argument for <code class="highlighter-rouge">group()</code>, which essentially tells Grakn to group the result by username, and count the number of occurences per username.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">qb</span><span class="o">.</span><span class="na">match</span><span class="o">(</span>
  <span class="n">var</span><span class="o">(</span><span class="s">"user"</span><span class="o">).</span><span class="na">isa</span><span class="o">(</span><span class="s">"user"</span><span class="o">),</span>
  <span class="n">var</span><span class="o">(</span><span class="s">"tweet"</span><span class="o">).</span><span class="na">isa</span><span class="o">(</span><span class="s">"tweet"</span><span class="o">),</span>
  <span class="n">var</span><span class="o">().</span><span class="na">rel</span><span class="o">(</span><span class="s">"posts"</span><span class="o">,</span> <span class="s">"user"</span><span class="o">).</span><span class="na">rel</span><span class="o">(</span><span class="s">"posted_by"</span><span class="o">,</span> <span class="s">"tweet"</span><span class="o">).</span><span class="na">isa</span><span class="o">(</span><span class="s">"user-tweet-relationship"</span><span class="o">)</span>
<span class="o">).</span><span class="na">aggregate</span><span class="o">(</span><span class="n">group</span><span class="o">(</span><span class="s">"user"</span><span class="o">,</span> <span class="n">count</span><span class="o">()));</span>
</code></pre></div></div>

<p>The query will now return “the number of tweet a user has posted”, which is what we want, as an object of type <code class="highlighter-rouge">Map&lt;Concept, Long&gt;</code>. To be able to conveniently iterate, we will transform it into the relatively more straightforward type <code class="highlighter-rouge">Stream&lt;Map.Entry&lt;String, Long&gt;&gt;</code>, i.e., a stream of pairs of username and tweet count.</p>

<pre><code class="language-java-test-ignore">  // execute query
  Map&lt;Concept, Long&gt; result = ((Map&lt;Concept, Long&gt;) q.execute());

  // map Map&lt;Concept, Long&gt; into Stream&lt;Map.Entry&lt;String, Long&gt;&gt; before returning
  AttributeType screenNameAttributeType = tx.getAttributeType("screen_name");

  Stream&lt;Map.Entry&lt;String, Long&gt;&gt; mapped = result.entrySet().stream().map(entry -&gt; {
    Concept key = entry.getKey();
    Long value = entry.getValue();
    String screenName = (String) key.asEntity().attributes(screenNameAttributeType).iterator().next().getValue();
    return new HashMap.SimpleImmutableEntry&lt;&gt;(screenName, value);
  });
</code></pre>

<p>Voila! Here’s how <code class="highlighter-rouge">calculateTweetCountPerUser</code> should look like.</p>

<pre><code class="language-java-test-ignore">public static Stream&lt;Map.Entry&lt;String, Long&gt;&gt; calculateTweetCountPerUser(GraknTx tx) {
  // build query
  QueryBuilder qb = tx.graql();
  AggregateQuery q = qb.match(
      var("user").isa("user"),
      var("tweet").isa("tweet"),
      var().rel("posts", "user").rel("posted_by", "tweet").isa("user-tweet-relationship")
      ).aggregate(group("user", count()));

  // execute query
  Map&lt;Concept, Long&gt; result = ((Map&lt;Concept, Long&gt;) q.execute());

  // map Map&lt;Concept, Long&gt; into Stream&lt;Map.Entry&lt;String, Long&gt;&gt; before returning
  AttributeType screenNameAttributeType = tx.getAttributeType("screen_name");

  Stream&lt;Map.Entry&lt;String, Long&gt;&gt; mapped = result.entrySet().stream().map(entry -&gt; {
    Concept key = entry.getKey();
    Long value = entry.getValue();
    String screenName = (String) key.asEntity().attributes(screenNameAttributeType).iterator().next().getValue();
    return new HashMap.SimpleImmutableEntry&lt;&gt;(screenName, value);
  });

  return mapped;
}
</code></pre>

<p>With that done, let’s update our <code class="highlighter-rouge">main</code> like so. We’ve introduced two changes here. First we’ve added the call to our newly made function <code class="highlighter-rouge">calculateTweetCountPerUser</code>. Second, we’re adding a pretty print function <code class="highlighter-rouge">prettyPrintQueryResult</code> to display our query in a nice way.</p>

<pre><code class="language-java-test-ignore">public class Main {
  // Twitter credentials
  private static final String consumerKey = "...";
  private static final String consumerSecret = "...";
  private static final String accessToken = "...";
  private static final String accessTokenSecret = "...";

  // Grakn settings
  private static final String implementation = Grakn.IN_MEMORY;
  private static final String keyspace = "twitter-example";

  public static void main(String[] args) {
    try (GraknSession session = Grakn.session(mplementation, keyspace)) {
      withGraknTx(session, tx -&gt; initTweetSchema(tx)); // initialize schema

      listenToTwitterStreamAsync(consumerKey, consumerSecret, accessToken, accessTokenSecret, (screenName, tweet) -&gt; {
        withGraknTx(session, tx -&gt; {
          insertUserTweet(tx, screenName, tweet); // insert tweet
          Stream&lt;Map.Entry&lt;String, Long&gt;&gt; result = calculateTweetCountPerUser(tx); // query
          prettyPrintQueryResult(result); // display
        });
      });
    }
  }

  public static void prettyPrintQueryResult(Stream&lt;Map.Entry&lt;String, Long&gt;&gt; result) {
    System.out.println("------");
    result.forEach(e -&gt; System.out.println("-- user " + e.getKey() + " tweeted " + e.getValue() + " time(s)."));
    System.out.println("------");
  }
}
</code></pre>

<h2 id="running-the-application">Running The Application</h2>

<p>We’re all set! The only thing left is to run the application. Let’s do it right away.</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mvn package
java <span class="nt">-jar</span> target/twitterexample-1.0-SNAPSHOT.jar
</code></pre></div></div>

<p>Watch the terminal as the application runs. You should see the following text printed everytime there’s an incoming tweet:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>------
-- user knowl3dg3 tweeted 2 time(s).
-- user gr4ph tweeted 1 time(s).
-- user w1th tweeted 1 time(s).
-- user gr4kn tweeted 1 time(s).
------
</code></pre></div></div>

<p>Finally, we have shown you many useful concepts — from creating a schema, storing data, crafting a Graql query, as well as displaying the result of the query. These are fundamental concepts that you will likely use in almost every area.</p>


    <div class="tags">
        
        <b>Tags: </b>
        
        
        
        <a href="/tag_analytics.html" class="btn btn-default navbar-btn cursorNorm" role="button">analytics</a>
        
        
        
        
        
        
        
        
        
        <a href="/tag_examples.html" class="btn btn-default navbar-btn cursorNorm" role="button">examples</a>
        
        
        
    </div>

    

</div>

<!-- <hr class="shaded"/> -->


            <div class="footer">
    <div class="container footer__container footer__social">
       <div class="footer__social__buttons"><a href="https://twitter.com/graknlabs" target="_blank"><i class="fa fa-twitter"></i></a><a href="https://www.facebook.com/groups/1913787625527508/" target="_blank"><i class="fa fa-facebook-f"></i></a><a href="http://linkedin.com/organization/graknlabs" target="_blank"><i class="fa fa-linkedin"></i></a><a href="https://github.com/graknlabs/grakn" target="_blank"><i class="fa fa-github"></i></a></div>
       <div class="footer__social__signup"><input id="footer-subscribe-input" type="text" value="" placeholder="Subscribe to our newsletter"><button id="footer-subscribe-btn" class="button-footer--red">Subscribe</button></div>
       <span id="footer__consent">By submitting your personal data, you consent to emails from Grakn. See our <a href="https://grakn.ai/privacy-policy" className="animated__link animated__link--purple">Privacy Policy</a></span>
    </div>
    <div class="container footer__container">
       <div class="footer__block">
          <div class="footer__block__header">GET IN TOUCH</div>
          <div class="footer__block__links">
             <a href="https://github.com/graknlabs/grakn" target="_blank" class="footer__block__links--github">
                <img src="/images/github.svg" alt="github"><strong id="download_footer">Grakn</strong><!-- react-text: 237 --> on Github<!-- /react-text -->
             </a>
             <a class="footer__block__links--slack" href="https://grakn.ai/slack">
                <img src="/images/slack-mark.svg" alt="slack"><strong>Grakn</strong><!-- react-text: 241 --> on Slack<!-- /react-text -->
             </a>
             <a href="mailto:enterprise@grakn.ai">
                <i class="fa fa-phone" aria-hidden="true"></i><!-- react-text: 244 -->Get in touch<!-- /react-text -->
             </a>
             <div class="footer__block__links--address">
                <span>
                   <i class="fa fa-map-marker" aria-hidden="true"></i><!-- react-text: 248 -->Unit 22, 8 Hornsey St.<!-- /react-text -->
                </span>
                <span> London N7 8EG, UK </span><a href="mailto:info@grakn.ai">info@grakn.ai</a>
             </div>
          </div>
       </div>
       <div class="footer__block">
          <div class="footer__block__header">PRODUCTS</div>
          <div class="footer__block__links"><a href="https://grakn.ai/grakn-core">Grakn Core</a><a href="https://grakn.ai/grakn-kbms">Grakn KBMS</a><a href="https://dev.grakn.ai/documentation/get-started/quickstart-tutorial">Quickstart</a><a href="https://grakn.ai/download">Install</a></div>
       </div>
       <div class="footer__block">
          <div class="footer__block__header">SOLUTIONS</div>
          <div class="footer__block__links"><a href="https://grakn.ai/deployment">Deployment</a><a href="https://grakn.ai/services">Services</a><a href="https://grakn.ai/support">Support</a></div>
       </div>
       <div class="footer__block">
          <div class="footer__block__header">USE CASES</div>
          <div class="footer__block__links"><a href="https://grakn.ai/usecase-bots">Intelligent Bots</a><a href="https://grakn.ai/usecase-search">Semantic Search</a><a href="https://grakn.ai/usecase-finance">Financial Services</a><a href="https://grakn.ai/usecase-health">Life Sciences</a><a href="https://grakn.ai/usecase-security">Security</a></div>
       </div>
       <div class="footer__block">
          <div class="footer__block__header">DEVELOPER</div>
          <div class="footer__block__links"><a href="https://dev.grakn.ai/academy/">Academy</a><a href="https://dev.grakn.ai">Documentation</a><a href="https://grakn.ai/community">Community</a><a href="https://discuss.grakn.ai/">Discuss</a><a href="https://github.com/graknlabs/grakn" target="_blank">Github</a></div>
       </div>
       <div class="footer__block">
          <div class="footer__block__header">COMPANY</div>
          <div class="footer__block__links"><a href="https://blog.grakn.ai/" target="_blank">Blog</a><a href="https://grakn.ai/careers">Careers</a><a href="https://grakn.ai/about">About</a></div>
       </div>
    </div>
 </div>
        </div>
    </div>
</div>
<!-- /.container -->
</body>


<!-- the google_analytics_id gets auto inserted from the config file -->



<script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-72414051-1','auto');ga('require','displayfeatures');ga('send','pageview');</script>


</html>